    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-300 py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p>&copy; 2025 VESSELAM PRO PUBLIC. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
                    <p class="text-sm mt-1">Counter-Strike 1.6 & Counter-Strike, Valve Corporation'Ä±n tescilli markalarÄ±dÄ±r.</p>
                </div>
                <div class="flex items-center">
                    <p class="mr-2">TarafÄ±ndan desteklenmektedir:</p>
                    <a href="https://csduragi.com" class="text-red-500 hover:text-red-400 font-bold">CSDuragi.com</a>
                </div>
            </div>
        </div>
    </footer>
    
    </div> <!-- Site Content End -->

    <script src="/js/script.js"></script>
    
    <!-- Loading Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Site iÃ§erik elementlerini al
            const loadingScreen = document.querySelector('.loading-screen');
            const siteContent = document.querySelector('.site-content');
            const loadingBar = document.querySelector('.loading-bar');
            
            // Sunucu oturum kimliÄŸi - sunucu her yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda deÄŸiÅŸir
            const serverSessionId = "<%= serverSessionId %>";
            
            // LocalStorage kontrolÃ¼ - ziyaretÃ§i bu sunucu oturumunda daha Ã¶nce gelmiÅŸ mi?
            const storedSessionId = localStorage.getItem('serverSessionId');
            const hasVisitedThisSession = (storedSessionId === serverSessionId);
            
            console.log("Sunucu oturum kimliÄŸi:", serverSessionId);
            console.log("KayÄ±tlÄ± oturum kimliÄŸi:", storedSessionId);
            console.log("Bu oturumda ziyaret edildi mi:", hasVisitedThisSession);
            
            // Ä°lk ziyaret veya sunucu yeniden baÅŸlatÄ±lmÄ±ÅŸsa yÃ¼kleme ekranÄ±nÄ± gÃ¶ster
            if (!hasVisitedThisSession) {
                // YÃ¼kleme ekranÄ±nÄ± gÃ¶ster
                loadingScreen.style.display = 'flex';
                siteContent.classList.remove('visible');
                
                // Loadingbar animasyonunu baÅŸlat
                loadingBar.style.animation = 'loadingAnimation 9s linear forwards, gradientShift 3s linear infinite';
                
                // 9 saniye sonra yÃ¼kleme ekranÄ±nÄ± kaldÄ±r
                setTimeout(function() {
                    loadingScreen.classList.add('hidden');
                    siteContent.classList.add('visible');
                    
                    // Mevcut sunucu oturum kimliÄŸini kaydet
                    localStorage.setItem('serverSessionId', serverSessionId);
                    
                    console.log("YÃ¼kleme ekranÄ± gizlendi, oturum kimliÄŸi kaydedildi:", serverSessionId);
                }, 9000);
            } else {
                // Daha Ã¶nce bu sunucu oturumunda ziyaret edilmiÅŸse, yÃ¼kleme ekranÄ±nÄ± gizle
                loadingScreen.style.display = 'none';
                siteContent.classList.add('visible');
                console.log("Ã–nceki ziyaret tespit edildi, yÃ¼kleme ekranÄ± atlandÄ±.");
            }
            
            // Sunucu verilerini ve oyuncu verilerini yÃ¼kle
            fetchServerData();
        });
        
        // Server verilerini yÃ¼klemek iÃ§in fetch API kullanÄ±mÄ±
        function fetchServerData() {
            // API endpoint kontrolÃ¼ - link parametrelerinden gelen verileri kontrol et
            let serverIP = getParameterByName('serverIP');
            let apiUrl = '/api/server-status';
            
            // EÄŸer URL'de serverIP parametresi varsa, API url'sine ekle
            if (serverIP) {
                apiUrl += '?serverIP=' + encodeURIComponent(serverIP);
            }
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Sunucu verisi alÄ±namadÄ±: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Sunucu verileri baÅŸarÄ±yla alÄ±ndÄ±:", data);
                    // Veriyi global olarak saklayÄ±p, sayfa yeniden yÃ¼klenmeden eriÅŸilebilir kÄ±lalÄ±m
                    window.serverData = data;
                    // UI'Ä± gÃ¼ncelle
                    updateServerUI(data);
                    // Oyuncu verilerini gÃ¼ncelle
                    updatePlayerData(data);
                })
                .catch(error => {
                    console.error('Veri Ã§ekme hatasÄ±:', error);
                    // Hata durumunda varsayÄ±lan deÄŸerleri gÃ¶ster
                    showDefaultServerValues();
                });
        }
        
        // URL'den parametre alma yardÄ±mcÄ± fonksiyonu
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
        
        // UI gÃ¼ncelleme fonksiyonu
        function updateServerUI(data) {
            if (!data) return;
            
            // Server durumu elementi
            const serverStatusBox = document.querySelector('.server-status-box');
            if (!serverStatusBox) return;
            
            // Server statusunu gÃ¼ncelle
            const statusElement = serverStatusBox.querySelector('.flex.items-center');
            if (statusElement && data.status) {
                if (data.status === 'online') {
                    const playerCount = data.players ? `${data.players.online}/${data.players.max} Oyuncu` : '0/32 Oyuncu';
                    statusElement.innerHTML = `
                        <span class="w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                        <p class="text-green-400">Online - ${playerCount}</p>
                    `;
                } else {
                    statusElement.innerHTML = `
                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                        <p class="text-red-400">Offline</p>
                    `;
                }
            }
            
            // Aktif haritayÄ± gÃ¼ncelle
            const mapElement = serverStatusBox.querySelector('.text-right p.text-yellow-400');
            if (mapElement && data.map) {
                mapElement.textContent = data.map;
            }
            
            // Server IP'yi gÃ¼ncelle
            const serverIPElement = document.querySelector('.server-ip');
            if (serverIPElement && data.serverIP) {
                serverIPElement.textContent = data.serverIP;
            }
            
            // BaÄŸlan butonunu gÃ¼ncelle
            const connectButton = document.querySelector('a[href^="steam://connect/"]');
            if (connectButton && data.serverIP) {
                connectButton.href = `steam://connect/${data.serverIP}`;
            }
        }
        
        // Oyuncu verilerini gÃ¼ncelleme fonksiyonu
        function updatePlayerData(data) {
            if (!data) {
                console.log("Veri bulunamadÄ±");
                return;
            }
            
            console.log("Sunucu verileri:", data);
            
            // Oyuncular listesini al (API'den doÄŸrudan gelen ctPlayers/tPlayers/spectators kullan)
            const ctPlayers = data.ctPlayers || [];
            const tPlayers = data.tPlayers || [];
            const spectators = data.spectators || [];
            
            console.log(`Oyuncu verileri: CT=${ctPlayers.length}, T=${tPlayers.length}, SPEC=${spectators.length}`);
            
            // CT TakÄ±mÄ±
            const ctTeamElement = document.getElementById('takim-ct');
            const tTeamElement = document.getElementById('takim-t');
            const specTeamElement = document.getElementById('takim-spec');
            
            // TakÄ±m elementleri yoksa sayfa oyuncu sayfasÄ± deÄŸildir
            if (!ctTeamElement && !tTeamElement && !specTeamElement) {
                console.log("Oyuncu tablolarÄ± bulunamadÄ± - muhtemelen oyuncu sayfasÄ±nda deÄŸiliz");
                return;
            }
            
            // TakÄ±m tablolarÄ±nÄ± gÃ¼ncelle
            updateTeamTable(ctTeamElement, ctPlayers, 'CT');
            updateTeamTable(tTeamElement, tPlayers, 'T');
            updateTeamTable(specTeamElement, spectators, 'SPEC');
            
            // Ä°statistik panellerini gÃ¼ncelle
            updateStatPanels(ctPlayers, tPlayers);
            
            // TakÄ±m boÅŸ uyarÄ±larÄ±nÄ± gÃ¼ncelle
            const tables = [
                { element: ctTeamElement, players: ctPlayers, name: 'CT' },
                { element: tTeamElement, players: tPlayers, name: 'T' },
                { element: specTeamElement, players: spectators, name: 'SPEC' }
            ];
            
            tables.forEach(table => {
                if (table.element) {
                    const noPlayersMessage = table.element.querySelector('.no-players-message');
                    if (table.players.length === 0) {
                        // TakÄ±mda oyuncu yoksa, mesaj gÃ¶ster
                        if (!noPlayersMessage) {
                            const message = document.createElement('div');
                            message.className = 'no-players-message p-4 text-center text-gray-500';
                            message.innerHTML = `<i class="fas fa-user-slash mr-2"></i>${table.name} TakÄ±mÄ±nda oyuncu yok.`;
                            table.element.appendChild(message);
                        }
                    } else {
                        // TakÄ±mda oyuncu varsa, mesajÄ± kaldÄ±r
                        if (noPlayersMessage) {
                            noPlayersMessage.remove();
                        }
                    }
                }
            });
        }
        
        // Ä°statistik panellerini gÃ¼ncelleme fonksiyonu
        function updateStatPanels(ctPlayers, tPlayers) {
            // TÃ¼m oyuncularÄ± birleÅŸtir
            const allPlayers = [...(ctPlayers || []), ...(tPlayers || [])];
            
            // Top Players panelini gÃ¼ncelle (skor bazlÄ±)
            updateTopPlayersList(allPlayers, 'top-players-list', 'score');
            
            // Top Killers panelini gÃ¼ncelle (kill bazlÄ±)
            updateTopPlayersList(allPlayers, 'top-killers-list', 'kills');
            
            // Best K/D panelini gÃ¼ncelle
            updateKDRatioList(allPlayers, 'top-kd-list');
        }
        
        // En iyi oyuncu listesini gÃ¼ncelle
        function updateTopPlayersList(players, listId, sortKey) {
            const list = document.getElementById(listId);
            if (!list) return;
            
            // Listeyi temizle
            list.innerHTML = '';
            
            // Oyuncu yoksa mesaj gÃ¶ster
            if (!players || players.length === 0) {
                list.innerHTML = '<li class="text-center p-3 text-gray-400">Veri yok</li>';
                return;
            }
            
            // OyuncularÄ± sÄ±rala ve ilk 5'i al
            const sortedPlayers = [...players].sort((a, b) => (b[sortKey] || 0) - (a[sortKey] || 0)).slice(0, 5);
            
            // Her oyuncu iÃ§in bir liste Ã¶ÄŸesi oluÅŸtur
            const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];
            sortedPlayers.forEach((player, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center justify-between p-2 bg-gray-600 rounded-md';
                
                const valueText = sortKey === 'score' ? 'puan' : 'kill';
                const valueColor = sortKey === 'score' ? 'text-yellow-400' : 'text-green-400';
                
                listItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-xl mr-2">${medals[index]}</span>
                        <span>${player.name}</span>
                    </div>
                    <div class="${valueColor} font-bold">${player[sortKey] || 0} ${valueText}</div>
                `;
                
                list.appendChild(listItem);
            });
        }
        
        // K/D oranÄ± listesini gÃ¼ncelle
        function updateKDRatioList(players, listId) {
            const list = document.getElementById(listId);
            if (!list) return;
            
            // Listeyi temizle
            list.innerHTML = '';
            
            // Oyuncu yoksa mesaj gÃ¶ster
            if (!players || players.length === 0) {
                list.innerHTML = '<li class="text-center p-3 text-gray-400">Veri yok</li>';
                return;
            }
            
            // Ã–lÃ¼mÃ¼ 0'dan bÃ¼yÃ¼k olan oyuncularÄ± filtrele, KD oranÄ± hesapla, sÄ±rala ve ilk 5'i al
            const playersWithKD = players
                .filter(p => p.deaths > 0)
                .map(p => ({...p, kd: (p.kills || 0) / (p.deaths || 1)}))
                .sort((a, b) => b.kd - a.kd)
                .slice(0, 5);
            
            // EÄŸer hiÃ§ uygun oyuncu yoksa mesaj gÃ¶ster
            if (playersWithKD.length === 0) {
                list.innerHTML = '<li class="text-center p-3 text-gray-400">Veri yok</li>';
                return;
            }
            
            // Her oyuncu iÃ§in bir liste Ã¶ÄŸesi oluÅŸtur
            const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', '4ï¸âƒ£', '5ï¸âƒ£'];
            playersWithKD.forEach((player, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center justify-between p-2 bg-gray-600 rounded-md';
                
                listItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-xl mr-2">${medals[index]}</span>
                        <span>${player.name}</span>
                    </div>
                    <div class="text-blue-400 font-bold">${player.kd.toFixed(2)}</div>
                `;
                
                list.appendChild(listItem);
            });
        }
        
        // TakÄ±m tablosunu gÃ¼ncelleme
        function updateTeamTable(teamElement, players, teamName) {
            if (!teamElement) return;
            
            const tableBody = teamElement.querySelector('tbody');
            if (!tableBody) {
                console.error(`${teamName} takÄ±mÄ± iÃ§in tablo gÃ¶vdesi bulunamadÄ±`);
                return;
            }
            
            // Tabloyu temizle
            tableBody.innerHTML = '';
            
            // TakÄ±mda oyuncu varsa
            if (players.length > 0) {
                // OyuncularÄ± tabloya ekle
                players.forEach((player, index) => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-600 border-b border-gray-600 last:border-0';
                    
                    const kdRatio = player.deaths > 0 ? (player.kills / player.deaths).toFixed(2) : player.kills || '0';
                    
                    row.innerHTML = `
                        <td class="text-center p-2">${index + 1}</td>
                        <td class="p-2 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full inline-block mr-2"></span>
                            ${player.name}
                        </td>
                        <td class="text-center p-2">${player.score || 0}</td>
                        <td class="text-center p-2 text-green-400">${player.kills || 0}</td>
                        <td class="text-center p-2 text-red-400">${player.deaths || 0}</td>
                        <td class="text-center p-2">
                            <span class="${kdRatio >= 1 ? 'text-green-400' : 'text-red-400'}">${kdRatio}</span>
                        </td>
                        <td class="text-center p-2">
                            <span class="${player.ping < 100 ? 'text-green-400' : (player.ping < 200 ? 'text-yellow-400' : 'text-red-400')}">
                                ${player.ping || 0} ms
                            </span>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
        }
        
        // KD oranÄ± hesaplama
        function calculateKD(kills, deaths) {
            kills = parseInt(kills || 0);
            deaths = parseInt(deaths || 0);
            
            if (deaths === 0) return kills.toFixed(2);
            return (kills / deaths).toFixed(2);
        }
        
        // VarsayÄ±lan deÄŸerleri gÃ¶sterme fonksiyonu
        function showDefaultServerValues() {
            // VarsayÄ±lan deÄŸerleri gÃ¶ster
            const serverStatusBox = document.querySelector('.server-status-box');
            if (serverStatusBox) {
                const statusElement = serverStatusBox.querySelector('.flex.items-center');
                if (statusElement) {
                    statusElement.innerHTML = `
                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                        <p class="text-red-400">Offline</p>
                    `;
                }
                
                const mapElement = serverStatusBox.querySelector('.text-right p.text-yellow-400');
                if (mapElement) {
                    mapElement.textContent = 'de_dust2';
                }
            }
            
            // Oyuncu tablolarÄ±nÄ± gÃ¼ncelle - boÅŸ olarak
            updatePlayerData({
                ctPlayers: [],
                tPlayers: [],
                spectators: []
            });
        }
    </script>
</body>
</html> 